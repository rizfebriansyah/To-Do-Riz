const FORMURLENCODED=require("form-urlencoded"),STRIPE_URL="https://api.stripe.com/v1/",PAYMENT_METHOD_URL="https://api.stripe.com/v1/payment_methods",SETUP_INTENT_URL="https://api.stripe.com/v1/setup_intents";function _findType(e,t){return null!=e.card?t.indexOf("card"):null!=e.bank_account?t.indexOf("bank_account"):null!=e.pii&&t.indexOf("pii")}function _convertDetails(e,t){var n={};for(var r in t){n[e+"["+r+"]"]=t[r]}return n}async function _parseJSON(e){if(null===e._bodyInit)return e;return await e.json()}function _createTokenHelper(e,t){const n=FORMURLENCODED(e);return fetch(STRIPE_URL+"tokens",{method:"post",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer "+t},body:n})}module.exports=function(e){return{createToken:async function(t){const n=Object.keys(t),r=_findType(t,n);var a;if(0===r){let c=n[r];var o=_convertDetails(c,t[c]);a=await _createTokenHelper(o,e)}else a=await _createTokenHelper(t,e);return _parseJSON(a)},createPaymentMethod:async function(t,n){const{number:r,cvc:a,exp_month:o,exp_year:c}=n,i=`type=${t}&card[number]=${r}&card[cvc]=${a}&card[exp_month]=${o}&card[exp_year]=${c}&key=${e}`,p=await fetch("https://api.stripe.com/v1/payment_methods",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i});return await p.json()},handleCardSetup:async function(t,n,r){const a=`${SETUP_INTENT_URL}/${t}/confirm`,o=`payment_method=${n}&expected_payment_method_type=card&key=${e}&client_secret=${r}`,c=await fetch(a,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});return await c.json()}}};